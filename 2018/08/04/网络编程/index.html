<html>
  <head><meta name="generator" content="Hexo 3.8.0">
    <title>网络编程 - 痛点就是起点</title>
    <link href="/images/fav.png" rel="shortcut icon">
<link href="/atom.xml" rel="alternate" type="application/rss+xml">
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/highlight.css">
<link rel="stylesheet" href="/css/responsive.css">
<script src="/js/jquery.js"></script>
<script src="/js/basics.js"></script>
<meta content="width=device-width, initial-scale=1.0, user-scalable=no" name="viewport">
<meta content="text/html; charset=utf-8" http-equiv="content-type">


  </head>
  <body>
    <header>
  <a id="go-back-home" href="/"><img src="/images/logo.jpg" alt="Home" width="53" height="59"></a>
  <p>痛点就是起点</p>
  <p>Speaking is as important as doing!</p>
</header>

    <div id="container">
      <div class="block">
  
    <a class="main" href="/">Home</a>
  
    <a class="main" href="/ToYou">ToYou</a>
  
    <a class="main" href="/categories">Categories</a>
  
    <a class="main" href="/atom.xml">RSS</a>
  
</div>

      <section class="paging">
  
    <div class="left">
      <a href="/2018/08/05/学一点XPath/">
        ‹
      </a>
    </div>
  
  
    <div class="right">
      <a href="/2018/08/03/分布式进程/">
        ›
      </a>
    </div>
  
</section>

      <div class="content">
        <section class="post">
          <h1>
            <div class="date">2018-08-04</div>
            网络编程
          </h1>
          <p>提及网络编程，就不得不提　Socket(套接字) 概念。Socket 是网络编程中的一个抽象概念，通常我们用一个 Socket 表示“打开一个网络链接”，把打开链接的目标计算机的 IP 地址和端口号，以及协议类型等信息存储到 Socket 里。</p>
<p>python 进行网络编程时，实际上是　python 程序本身的进程连接到服务器进程的通信端口进行通信，可以看作是两个进程间的通信。python 提供了两个基本的　Socket 模块实现网络编程，分别为 Socket 和 SocketServer。</p>
<blockquote>
<ol>
<li>Socket 提供了标准的 BSD Sockets API。</li>
<li>SocketServer 提供了服务器中心类，可以简化网络服务器的开发。</li>
</ol>
</blockquote>
<h4 id="1-1-Socket-类型"><a href="#1-1-Socket-类型" class="headerlink" title="1.1 Socket 类型"></a>1.1 Socket 类型</h4><p>Socket 格式为：socket(family, type[,protocal])，需要给定地址族、套接字类型、协议编号来创建　Socket。</p>
<table>
<thead>
<tr>
<th>Socket类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>socket.AF_UNIX</td>
<td>只能用于单一的 Unix 系统进程间通信</td>
</tr>
<tr>
<td>socket.AF_INET</td>
<td>服务器之间网络通信</td>
</tr>
<tr>
<td>socket.AF_INET6</td>
<td>服务器之间 IPv6 网络通信</td>
</tr>
<tr>
<td>socket.SOCK_STREAM</td>
<td>流式 socket，用于 TCP</td>
</tr>
<tr>
<td>socket.SOCK_DGAM</td>
<td>数据报式 socket，用于 UDP</td>
</tr>
<tr>
<td>socket.SOCK_RAM</td>
<td>原始套接字，普通的套接字无法处理 ICMP、IGMP　等网络报文，而 SOCK_RAM 可以；其次，SOCK_RAM 也可以处理特殊的 IPv4 报文；此外，利用原始套接字，可以通过 IP_HDRINCL 套接字选项由用户构造 IP 头</td>
</tr>
<tr>
<td>socket.SOCK_SEQPACKET</td>
<td>可靠的连续数据报服务</td>
</tr>
<tr>
<td>创建 TCP Socket</td>
<td>socket(socket.AF_INET, socket.SOCK_STREAM)</td>
</tr>
<tr>
<td>创建 UDP Socket</td>
<td>socket(socket.AF_INET, socket.SOCK_DGRAM)</td>
</tr>
</tbody>
</table>
<h4 id="1-2-Socket-函数"><a href="#1-2-Socket-函数" class="headerlink" title="1.2 Socket 函数"></a>1.2 Socket 函数</h4><p>服务器 Socket 函数：</p>
<table>
<thead>
<tr>
<th>Socket 函数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>s.bind(address)</td>
<td>将套接字绑定到地址，在 AF_INET 下，以元祖 (host, port) 的形式表示地址</td>
</tr>
<tr>
<td>s.listen(backlog)</td>
<td>开始监听 TCP 传入连接。backlog 指定在拒绝连接之前，操作系统可以挂起的最大的连接数量。该值最小为１，大部分情况设为５就可以了</td>
</tr>
<tr>
<td>s.accept()</td>
<td>接受 TCP 连接并返回 (conn, address) ，其中 conn 是新的套接字对象，可以用来接收和发送数据；address 是连接客户端的地址</td>
</tr>
</tbody>
</table>
<p>　<br>客户端 Socket 函数：</p>
<table>
<thead>
<tr>
<th>Socket 函数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>s.connect(address)</td>
<td>连接到 address 处的套接字。一般 address 的格式为元祖 (host, port) ，如果连接出错，返回 socket.error 错误</td>
</tr>
<tr>
<td>s.connect_ex(address)</td>
<td>功能与 connect(address) 相同，但是连接成功返回 0，连接失败返回 errno 的值</td>
</tr>
</tbody>
</table>
<p>公共 Socket 函数：</p>
<table>
<thead>
<tr>
<th>Socket 函数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>s.recv(bufsize[,flag])</td>
<td>接收 TCP 套接字数据，数据以字符串形式返回</td>
</tr>
<tr>
<td>s.send(string[,flag])</td>
<td>发送 TCP 套接字数据，返回发送数据的字节数</td>
</tr>
<tr>
<td>s.sendall(string[,flag])</td>
<td>完整发送 TCP 套接字数据，成功返回 None，失败抛出异常</td>
</tr>
<tr>
<td>s.recvfrom(bufsize[,flag])</td>
<td>接收 UDP 套接字数据，返回 (data, address)</td>
</tr>
<tr>
<td>s.sendto(string[,flag],address)</td>
<td>发送 UDP 套接字数据，返回发送数据的字节数</td>
</tr>
</tbody>
</table>
<p>还有一些公共 Socket 函数，如：s.close()，s.getpeername()，s.getsockname()，s.setsockopt(level, optname, value)，s.getsockopt(level, optname[,buflen])，s.settimeout(timeout)，s.setblocking(flag)　等，这些函数一般可以见名知意，且使用频率较低，如果需要了解，都可以查询 API 获得。</p>
<h3 id="2-TCP-编程"><a href="#2-TCP-编程" class="headerlink" title="2. TCP 编程"></a>2. TCP 编程</h3><p>TCP 是一种面向连接的通信方式，连接可靠，通信双方以流的形式发送数据。主动发起连接的是客户端，被动响应的是服务端。服务端程序编写步骤如下。</p>
<blockquote>
<ol>
<li>创建　Socket，绑定 Socket 到本地 IP 与端口。</li>
<li>开始监听连接。</li>
<li>进入循环，不断连接客户端的连接请求。</li>
<li>接收传来的数据，并发送给对方数据（一般为确认收到）。</li>
<li>传输完毕后，关闭 Socket。</li>
</ol>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> socket, threading, time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dealClient</span><span class="params">(sock, addr)</span>:</span></span><br><span class="line">    <span class="comment"># 第四步： 接收传来的数据，并发送给对方数据</span></span><br><span class="line">    print(<span class="string">'Accept new connection from %s:%s'</span> % addr)</span><br><span class="line">    sock.send(<span class="string">b'Hello,I am server!'</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        data = sock.recv(<span class="number">1024</span>)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data <span class="keyword">or</span> data.decode(<span class="string">'utf-8'</span>) == <span class="string">'exit'</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        print(<span class="string">'--- &gt; %s !'</span> % data.decode(<span class="string">'utf-8'</span>))</span><br><span class="line">        sock.send((<span class="string">'Loop_msg: %s!'</span> % data.decode(<span class="string">'utf-8'</span>)).encode(<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 第五步： 关闭 Socket</span></span><br><span class="line">    sock.close()</span><br><span class="line">    print(<span class="string">'Connection from %s:%s'</span> % addr)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># 第一步： 创建一个基于 IPV4 和 TCP 协议的 Socket</span></span><br><span class="line">    <span class="comment"># Socket 绑定的 IP(127.0.0.1 为本机 IP)与端口</span></span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s.bind((<span class="string">'127.0.0.1'</span>, <span class="number">9999</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 第二步： 监听链接</span></span><br><span class="line">    s.listen(<span class="number">5</span>)</span><br><span class="line">    print(<span class="string">'waiting for connection ...'</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        <span class="comment"># 第三步： 接收一个新连接</span></span><br><span class="line">        sock, addr = s.accept()</span><br><span class="line">        t = threading.Thread(target=dealClient, args=(sock, addr))</span><br><span class="line">        t.start()</span><br></pre></td></tr></table></figure>
<p>接下来，需要编写客户端程序，与服务端程序检修交互。客户端程序编写步骤如下。</p>
<blockquote>
<ol>
<li>创建　Socket，连接服务器地址。</li>
<li>连接后发送数据和接收数据。</li>
<li>传输完毕后，关闭 Socket。</li>
</ol>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># 初始化 Socket</span></span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 连接目标的 IP 和端口</span></span><br><span class="line">    s.connect((<span class="string">'127.0.0.1'</span>, <span class="number">9999</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 接收消息</span></span><br><span class="line">    print(<span class="string">'--- &gt; '</span> + s.recv(<span class="number">1024</span>).decode(<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 发送消息</span></span><br><span class="line">    s.send(<span class="string">b'Hello,I am client!'</span>)</span><br><span class="line">    print(<span class="string">'--- &gt; '</span> + s.recv(<span class="number">1024</span>).decode(<span class="string">'utf-8'</span>))</span><br><span class="line">    s.send(<span class="string">b'exit'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 关闭 Socket</span></span><br><span class="line">    s.close()</span><br></pre></td></tr></table></figure>
<p><img src="/images/2018/August/Screenshot%20from%202018-08-04%2013-38-59.png" alt=""></p>
<hr>
<p><img src="/images/2018/August/Screenshot%20from%202018-08-04%2013-39-31.png" alt=""></p>
<h3 id="3-UDP-编程"><a href="#3-UDP-编程" class="headerlink" title="3. UDP 编程"></a>3. UDP 编程</h3><p>UDP 是面向无连接的通信协议，使用 UDP 协议时，无需建立连接，只需知道对方的 IP 地址和端口号，就可以直接发送数据包，并不关心数据能否安全到达目的端。虽然 UDP 传输数据不可靠，没有建立连接的过程，但是 UDP 传输比 TCP 传输速度快，对于传输要求不严格的数据，可以采用 UDP 协议传输，从而提高速度。</p>
<p>UDP 服务端程序编写步骤：</p>
<blockquote>
<ol>
<li>创建 Socket，绑定制定的 IP 地址和端口。</li>
<li>直接发送数据和接收数据。</li>
<li>传输完毕后，关闭 Socket。</li>
</ol>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># 创建 Socket ，绑定指定的 IP 和端口</span></span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line">    s.bind((<span class="string">'127.0.0.2'</span>, <span class="number">9999</span>))</span><br><span class="line">    print(<span class="string">'Bind UDP on 127.0.0.2:9999 ...'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        <span class="comment"># 直接发送数据和接收数据</span></span><br><span class="line">        data, addr = s.recvfrom(<span class="number">1024</span>)</span><br><span class="line">        print(<span class="string">'Received from %s:%s.'</span> % addr)</span><br><span class="line">        s.sendto(<span class="string">b'Hello, %s!'</span> % data, addr)</span><br></pre></td></tr></table></figure>
<p>UDP 客户端程序编写步骤：</p>
<blockquote>
<ol>
<li>创建 Socket。</li>
<li>直接可以与服务端程序进行数据交互。</li>
<li>传输完毕后，关闭 Socket。</li>
</ol>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line">    <span class="keyword">for</span> data <span class="keyword">in</span> [<span class="string">b'hello'</span>, <span class="string">b'world'</span>]:</span><br><span class="line">        <span class="comment"># 发送数据</span></span><br><span class="line">        s.sendto(data, (<span class="string">'127.0.0.2'</span>, <span class="number">9999</span>))</span><br><span class="line">        <span class="comment"># 接收数据</span></span><br><span class="line">        print(s.recv(<span class="number">1024</span>).decode(<span class="string">'utf-8'</span>))</span><br><span class="line">    s.close()</span><br></pre></td></tr></table></figure>
<p><img src="/images/2018/August/Screenshot%20from%202018-08-04%2013-57-52.png" alt=""></p>
<hr>
<p><img src="/images/2018/August/Screenshot%20from%202018-08-04%2013-58-00.png" alt=""></p>

          <br>
<p> from yhw-miracle</p>
<p align="center"><img src="/images/qrcode_for_gh_5efb2780ab44_258.jpg" alt="痛点就是起点"></p>
<p align="center">算法和代码的世界不仅是学习的痛点，而且是成功的起点。欢迎关注，共同进步！</p>

        </section>
      </div>
      
      <!--<div class="block">
  
    <a class="main" href="/">Home</a>
  
    <a class="main" href="/ToYou">ToYou</a>
  
    <a class="main" href="/categories">Categories</a>
  
    <a class="main" href="/atom.xml">RSS</a>
  
</div>
-->
    </div>
    <footer>
  <span class="muted">&copy; 2016 - 2019 yhw-miracle. All Rights Reserved.</span><br>
  <!--<a href='https://github.com/saintwinkle/hexo-theme-scribble' class='muted'>built with Hexo using Scribble theme</a>-->
  <img src="/images/logo.jpg" width="53" height="59" alt="痛点就是起点">
</footer>

  </body>
</html>
