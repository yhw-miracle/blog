<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <meta name="generator" content="Jekyll">

  <title>网络编程</title>

  <link rel="stylesheet" href="/assets/css/main.css">
  
  <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="ATOM Feed" /> <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>网络编程 | yhw-miracle’s Blog</title>
<meta name="generator" content="Jekyll v3.8.6" />
<meta property="og:title" content="网络编程" />
<meta name="author" content="yhw-miracle" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="提及网络编程，就不得不提　Socket(套接字) 概念。Socket 是网络编程中的一个抽象概念，通常我们用一个 Socket 表示“打开一个网络链接”，把打开链接的目标计算机的 IP 地址和端口号，以及协议类型等信息存储到 Socket 里。" />
<meta property="og:description" content="提及网络编程，就不得不提　Socket(套接字) 概念。Socket 是网络编程中的一个抽象概念，通常我们用一个 Socket 表示“打开一个网络链接”，把打开链接的目标计算机的 IP 地址和端口号，以及协议类型等信息存储到 Socket 里。" />
<link rel="canonical" href="http://localhost:4000/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B" />
<meta property="og:url" content="http://localhost:4000/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B" />
<meta property="og:site_name" content="yhw-miracle’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-08-04T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"提及网络编程，就不得不提　Socket(套接字) 概念。Socket 是网络编程中的一个抽象概念，通常我们用一个 Socket 表示“打开一个网络链接”，把打开链接的目标计算机的 IP 地址和端口号，以及协议类型等信息存储到 Socket 里。","author":{"@type":"Person","name":"yhw-miracle"},"@type":"BlogPosting","url":"http://localhost:4000/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B","headline":"网络编程","dateModified":"2018-08-04T00:00:00+08:00","datePublished":"2018-08-04T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>


<body>
  <div id="wrapper">
    <header>
  <div>
    <a href="/">
    
    <h1>YHW-MIRACLE</h1>
    </a>
    <div class="header-links">
      <a href="/all_posts">
    <h2 class="header-link">All_Posts | </h2>
</a>
<a href="/about">
    <h2 class="header-link">About | </h2>
</a>
<a href="/categories">
    <h2 class="header-link">Categories | </h2>
</a>
<a href="/tags">
    <h2 class="header-link">Tags</h2>
</a>
<!--<a href="/atom.xml"><h2 class="header-link">RSS</h2></a>-->

    </div>
  </div>
</header>

    <div class="container">
      <section id="main_content">
        <article>
  <h2 align="center">网络编程</h2>
  <img src="/images/authorize.png" />
  <center>
    yhw-miracle writed in <time datetime="2018-08-04T00:00:00+08:00" class="by-line">August 4th, 2018</time>
  </center>
  <p>提及网络编程，就不得不提　Socket(套接字) 概念。Socket 是网络编程中的一个抽象概念，通常我们用一个 Socket 表示“打开一个网络链接”，把打开链接的目标计算机的 IP 地址和端口号，以及协议类型等信息存储到 Socket 里。</p>

<p>python 进行网络编程时，实际上是　python 程序本身的进程连接到服务器进程的通信端口进行通信，可以看作是两个进程间的通信。python 提供了两个基本的　Socket 模块实现网络编程，分别为 Socket 和 SocketServer。</p>

<blockquote>
  <ol>
    <li>Socket 提供了标准的 BSD Sockets API。</li>
    <li>SocketServer 提供了服务器中心类，可以简化网络服务器的开发。</li>
  </ol>
</blockquote>

<h4 id="11-socket-类型">1.1 Socket 类型</h4>
<p>Socket 格式为：socket(family, type[,protocal])，需要给定地址族、套接字类型、协议编号来创建　Socket。</p>

<table>
  <thead>
    <tr>
      <th>Socket类型</th>
      <th>描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>socket.AF_UNIX</td>
      <td>只能用于单一的 Unix 系统进程间通信</td>
    </tr>
    <tr>
      <td>socket.AF_INET</td>
      <td>服务器之间网络通信</td>
    </tr>
    <tr>
      <td>socket.AF_INET6</td>
      <td>服务器之间 IPv6 网络通信</td>
    </tr>
    <tr>
      <td>socket.SOCK_STREAM</td>
      <td>流式 socket，用于 TCP</td>
    </tr>
    <tr>
      <td>socket.SOCK_DGAM</td>
      <td>数据报式 socket，用于 UDP</td>
    </tr>
    <tr>
      <td>socket.SOCK_RAM</td>
      <td>原始套接字，普通的套接字无法处理 ICMP、IGMP　等网络报文，而 SOCK_RAM 可以；其次，SOCK_RAM 也可以处理特殊的 IPv4 报文；此外，利用原始套接字，可以通过 IP_HDRINCL 套接字选项由用户构造 IP 头</td>
    </tr>
    <tr>
      <td>socket.SOCK_SEQPACKET</td>
      <td>可靠的连续数据报服务</td>
    </tr>
    <tr>
      <td>创建 TCP Socket</td>
      <td>socket(socket.AF_INET, socket.SOCK_STREAM)</td>
    </tr>
    <tr>
      <td>创建 UDP Socket</td>
      <td>socket(socket.AF_INET, socket.SOCK_DGRAM)</td>
    </tr>
  </tbody>
</table>

<h4 id="12-socket-函数">1.2 Socket 函数</h4>
<p>服务器 Socket 函数：</p>

<p>| Socket 函数 | 描述 |
| —— | —— |
| s.bind(address) | 将套接字绑定到地址，在 AF_INET 下，以元祖 (host, port) 的形式表示地址 |
| s.listen(backlog) | 开始监听 TCP 传入连接。backlog 指定在拒绝连接之前，操作系统可以挂起的最大的连接数量。该值最小为１，大部分情况设为５就可以了 |
| s.accept() | 接受 TCP 连接并返回 (conn, address) ，其中 conn 是新的套接字对象，可以用来接收和发送数据；address 是连接客户端的地址 |
　
客户端 Socket 函数：</p>

<table>
  <thead>
    <tr>
      <th>Socket 函数</th>
      <th>描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>s.connect(address)</td>
      <td>连接到 address 处的套接字。一般 address 的格式为元祖 (host, port) ，如果连接出错，返回 socket.error 错误</td>
    </tr>
    <tr>
      <td>s.connect_ex(address)</td>
      <td>功能与 connect(address) 相同，但是连接成功返回 0，连接失败返回 errno 的值</td>
    </tr>
  </tbody>
</table>

<p>公共 Socket 函数：</p>

<table>
  <thead>
    <tr>
      <th>Socket 函数</th>
      <th>描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>s.recv(bufsize[,flag])</td>
      <td>接收 TCP 套接字数据，数据以字符串形式返回</td>
    </tr>
    <tr>
      <td>s.send(string[,flag])</td>
      <td>发送 TCP 套接字数据，返回发送数据的字节数</td>
    </tr>
    <tr>
      <td>s.sendall(string[,flag])</td>
      <td>完整发送 TCP 套接字数据，成功返回 None，失败抛出异常</td>
    </tr>
    <tr>
      <td>s.recvfrom(bufsize[,flag])</td>
      <td>接收 UDP 套接字数据，返回 (data, address)</td>
    </tr>
    <tr>
      <td>s.sendto(string[,flag],address)</td>
      <td>发送 UDP 套接字数据，返回发送数据的字节数</td>
    </tr>
  </tbody>
</table>

<p>还有一些公共 Socket 函数，如：s.close()，s.getpeername()，s.getsockname()，s.setsockopt(level, optname, value)，s.getsockopt(level, optname[,buflen])，s.settimeout(timeout)，s.setblocking(flag)　等，这些函数一般可以见名知意，且使用频率较低，如果需要了解，都可以查询 API 获得。</p>

<h3 id="2-tcp-编程">2. TCP 编程</h3>
<p>TCP 是一种面向连接的通信方式，连接可靠，通信双方以流的形式发送数据。主动发起连接的是客户端，被动响应的是服务端。服务端程序编写步骤如下。</p>

<blockquote>
  <ol>
    <li>创建　Socket，绑定 Socket 到本地 IP 与端口。</li>
    <li>开始监听连接。</li>
    <li>进入循环，不断连接客户端的连接请求。</li>
    <li>接收传来的数据，并发送给对方数据（一般为确认收到）。</li>
    <li>传输完毕后，关闭 Socket。</li>
  </ol>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># coding:utf-8
</span><span class="kn">import</span> <span class="nn">socket</span><span class="p">,</span> <span class="n">threading</span><span class="p">,</span> <span class="n">time</span>


<span class="k">def</span> <span class="nf">dealClient</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">addr</span><span class="p">):</span>
    <span class="c1"># 第四步： 接收传来的数据，并发送给对方数据
</span>    <span class="k">print</span><span class="p">(</span><span class="s">'Accept new connection from </span><span class="si">%</span><span class="s">s:</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">addr</span><span class="p">)</span>
    <span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">b</span><span class="s">'Hello,I am server!'</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span> <span class="ow">or</span> <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span> <span class="o">==</span> <span class="s">'exit'</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'--- &gt; </span><span class="si">%</span><span class="s">s !'</span> <span class="o">%</span> <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="p">((</span><span class="s">'Loop_msg: </span><span class="si">%</span><span class="s">s!'</span> <span class="o">%</span> <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span>

    <span class="c1"># 第五步： 关闭 Socket
</span>    <span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Connection from </span><span class="si">%</span><span class="s">s:</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">addr</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="c1"># 第一步： 创建一个基于 IPV4 和 TCP 协议的 Socket
</span>    <span class="c1"># Socket 绑定的 IP(127.0.0.1 为本机 IP)与端口
</span>    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="s">'127.0.0.1'</span><span class="p">,</span> <span class="mi">9999</span><span class="p">))</span>

    <span class="c1"># 第二步： 监听链接
</span>    <span class="n">s</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'waiting for connection ...'</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="c1"># 第三步： 接收一个新连接
</span>        <span class="n">sock</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">dealClient</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">addr</span><span class="p">))</span>
        <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</code></pre></div></div>

<p>接下来，需要编写客户端程序，与服务端程序检修交互。客户端程序编写步骤如下。</p>

<blockquote>
  <ol>
    <li>创建　Socket，连接服务器地址。</li>
    <li>连接后发送数据和接收数据。</li>
    <li>传输完毕后，关闭 Socket。</li>
  </ol>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># coding:utf-8
</span><span class="kn">import</span> <span class="nn">socket</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="c1"># 初始化 Socket
</span>    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>

    <span class="c1"># 连接目标的 IP 和端口
</span>    <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s">'127.0.0.1'</span><span class="p">,</span> <span class="mi">9999</span><span class="p">))</span>

    <span class="c1"># 接收消息
</span>    <span class="k">print</span><span class="p">(</span><span class="s">'--- &gt; '</span> <span class="o">+</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span>

    <span class="c1"># 发送消息
</span>    <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">b</span><span class="s">'Hello,I am client!'</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'--- &gt; '</span> <span class="o">+</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span>
    <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">b</span><span class="s">'exit'</span><span class="p">)</span>

    <span class="c1"># 关闭 Socket
</span>    <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/images/2018/August/Screenshot%20from%202018-08-04%2013-38-59.png" alt="" /></p>

<p><img src="/images/2018/August/Screenshot%20from%202018-08-04%2013-39-31.png" alt="" /></p>

<h3 id="3-udp-编程">3. UDP 编程</h3>
<p>UDP 是面向无连接的通信协议，使用 UDP 协议时，无需建立连接，只需知道对方的 IP 地址和端口号，就可以直接发送数据包，并不关心数据能否安全到达目的端。虽然 UDP 传输数据不可靠，没有建立连接的过程，但是 UDP 传输比 TCP 传输速度快，对于传输要求不严格的数据，可以采用 UDP 协议传输，从而提高速度。</p>

<p>UDP 服务端程序编写步骤：</p>

<blockquote>
  <ol>
    <li>创建 Socket，绑定制定的 IP 地址和端口。</li>
    <li>直接发送数据和接收数据。</li>
    <li>传输完毕后，关闭 Socket。</li>
  </ol>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># coding:utf-8
</span>
<span class="kn">import</span> <span class="nn">socket</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="c1"># 创建 Socket ，绑定指定的 IP 和端口
</span>    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="s">'127.0.0.2'</span><span class="p">,</span> <span class="mi">9999</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Bind UDP on 127.0.0.2:9999 ...'</span><span class="p">)</span>

    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="c1"># 直接发送数据和接收数据
</span>        <span class="n">data</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recvfrom</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Received from </span><span class="si">%</span><span class="s">s:</span><span class="si">%</span><span class="s">s.'</span> <span class="o">%</span> <span class="n">addr</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">sendto</span><span class="p">(</span><span class="n">b</span><span class="s">'Hello, </span><span class="si">%</span><span class="s">s!'</span> <span class="o">%</span> <span class="n">data</span><span class="p">,</span> <span class="n">addr</span><span class="p">)</span>
</code></pre></div></div>

<p>UDP 客户端程序编写步骤：</p>

<blockquote>
  <ol>
    <li>创建 Socket。</li>
    <li>直接可以与服务端程序进行数据交互。</li>
    <li>传输完毕后，关闭 Socket。</li>
  </ol>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># coding:utf-8
</span>
<span class="kn">import</span> <span class="nn">socket</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="p">[</span><span class="n">b</span><span class="s">'hello'</span><span class="p">,</span> <span class="n">b</span><span class="s">'world'</span><span class="p">]:</span>
        <span class="c1"># 发送数据
</span>        <span class="n">s</span><span class="o">.</span><span class="n">sendto</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="s">'127.0.0.2'</span><span class="p">,</span> <span class="mi">9999</span><span class="p">))</span>
        <span class="c1"># 接收数据
</span>        <span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span>
    <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/images/2018/August/Screenshot%20from%202018-08-04%2013-57-52.png" alt="" /></p>

<p><img src="/images/2018/August/Screenshot%20from%202018-08-04%2013-58-00.png" alt="" /></p>

</article>


	<div class="tags">
	<img src="/images/tag.png" />
	
		<a href="/tag/python">python</a>
	
		<a href="/tag/网络编程">网络编程</a>
	
		<a href="/tag/UDP">UDP</a>
	
		<a href="/tag/TCP">TCP</a>
	
	</div>






	<div class="categories">
	<img src="/images/category.png" />
	
	  <a href="/category/知识总结">知识总结</a>
	
	</div>




<div class="pagination">
    上一篇：
    
      <a href="/%E5%AD%A6%E4%B8%80%E7%82%B9XPath" class="previous">
        <img src="/images/previous.png" />
      </a>
    
  
    | 下一篇：
    
      <a href="/%E5%88%86%E5%B8%83%E5%BC%8F%E8%BF%9B%E7%A8%8B" class="next">
        <img src="/images/next.png" />
      </a>
    
  </div>


      </section>
    </div>
  </div>

  

  <div align="center" id="qecode_img">
  <hr />
  <p>欢迎关注，我们一起进行认知迭代！</p>
  <img src="/images/qrcode_for_gh_5efb2780ab44_258.jpg" /><br />
  痛点就是起点
</div>

<footer>
  <!-- <a href="https://blogs.yhw-miracle.cn">
    <span>
        <b>yhw-miracle</b>
    </span>
    
    <span>© 2016 - 2019</span>
  </a> -->
</footer>

<div align="center" style="font-size: 13px;">
  <hr />
  <span>&copy; 2016 - 2019</span>基于
  <a href="https://jekyllrb.com">jekyll</a> | 
  <a href="https://github.com">Github Pags</a> | 
  By <a href="blogs.yhw-miracle.cn">yhw-miracle</a>
</div>


  <!--  -->
</body>
</html>