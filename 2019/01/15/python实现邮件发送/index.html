<html>
  <head><meta name="generator" content="Hexo 3.8.0">
    <title>python实现邮件发送 - 痛点就是起点</title>
    <link href="/images/logo.jpg" rel="shortcut icon">
<link href="/atom.xml" rel="alternate" type="application/rss+xml">
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/highlight.css">
<link rel="stylesheet" href="/css/responsive.css">
<script src="/js/jquery.js"></script>
<script src="/js/basics.js"></script>
<meta content="width=device-width, initial-scale=1.0, user-scalable=no" name="viewport">
<meta content="text/html; charset=utf-8" http-equiv="content-type">


  </head>
  <body>
    <header>
  <a id="go-back-home" href="/"><img src="/images/logo.jpg" alt="Home" width="53" height="59"></a>
  <p>痛点就是起点</p>
  <p>Speaking is as important as doing!</p>
</header>

    <div id="container">
      <div class="block">
  
    <a class="main" href="/">Home</a>
  
    <a class="main" href="/ToYou">ToYou</a>
  
    <a class="main" href="/categories">Categories</a>
  
    <a class="main" href="/atom.xml">RSS</a>
  
</div>

      <section class="paging">
  
    <div class="left">
      <a href="/2019/01/15/详解基础爬虫架构/">
        ‹
      </a>
    </div>
  
  
    <div class="right">
      <a href="/2019/01/14/提取多媒体文件/">
        ›
      </a>
    </div>
  
</section>

      <div class="content">
        <section class="post">
          <h1>
            <div class="date">2019-01-15</div>
            python实现邮件发送
          </h1>
          <p>在爬虫开发中，爬虫运行过程中遇到异常或服务器遇到问题时，我们可以采用发送邮件，及时报告爬虫程序当前故障问题。</p>
<p>邮件发送协议是<code>SMTP</code>，<code>python</code>内置对<code>SMTP</code> 的支持，可以发送纯文本邮件、<code>HTML</code> 邮件以及带附件的邮件。<code>python</code>中对<code>SMTP</code>支持有 <code>smtpplib</code>和<code>email</code>模块，<code>email</code> 负责构造邮件，<code>smtplib</code>负责发送邮件。</p>
<p>1.以网易的邮件发送服务器为例<code>smtp.163.com</code>，需要开启网易邮箱的<code>smtp</code>功能。</p>
<p>2.构造纯文本邮件。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> email.mime.text <span class="keyword">import</span> MIMEText</span><br><span class="line">msg = MIMEText(<span class="string">"你好，世界！"</span>, <span class="string">"plain"</span>, <span class="string">"utf-8"</span>)</span><br></pre></td></tr></table></figure></p>
<p>构造<code>html</code>邮件。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> email.mime.text <span class="keyword">import</span> MIMEText</span><br><span class="line">msg = MIMEText(<span class="string">"&lt;a href='https://yhw-miracle.win/'&gt;my blog&lt;/a&gt;"</span>, <span class="string">"html"</span>, <span class="string">"utf-8"</span>)</span><br></pre></td></tr></table></figure></p>
<p>3.设置发件人信息、收件人信息和邮件主题信息。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from_addr = <span class="string">"yhw_software@163.com"</span></span><br><span class="line">password = <span class="string">"********"</span></span><br><span class="line"></span><br><span class="line">to_addr = <span class="string">"yhw_software@qq.com"</span></span><br><span class="line"></span><br><span class="line">smtp_server = <span class="string">"smtp.163.com"</span></span><br><span class="line"></span><br><span class="line">msg[<span class="string">'From'</span>] = format_addr(<span class="string">"我是 &lt;%s&gt;"</span> % from_addr)</span><br><span class="line">msg[<span class="string">"To"</span>] = format_addr(<span class="string">"你是 &lt;%s&gt;"</span> % to_addr)</span><br><span class="line">msg[<span class="string">"Subject"</span>] = Header(<span class="string">"晚安"</span>, <span class="string">"utf-8"</span>).encode()</span><br></pre></td></tr></table></figure></p>
<p>4.发送邮件。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server = smtplib.SMTP(smtp_server, <span class="number">25</span>)</span><br><span class="line">server.login(from_addr, password)</span><br><span class="line">server.sendmail(from_addr, [to_addr], msg.as_string())</span><br><span class="line">server.quit()</span><br></pre></td></tr></table></figure></p>
<p>完整代码如下所示。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> email.header <span class="keyword">import</span> Header</span><br><span class="line"><span class="keyword">from</span> email.mime.text <span class="keyword">import</span> MIMEText</span><br><span class="line"><span class="keyword">from</span> email.utils <span class="keyword">import</span> parseaddr, formataddr</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> smtplib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">format_addr</span><span class="params">(s)</span>:</span></span><br><span class="line">    name, addr = parseaddr(s)</span><br><span class="line">    <span class="keyword">return</span> formataddr((Header(name, <span class="string">"utf-8"</span>).encode(), addr))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">from_addr = <span class="string">"yhw_software@163.com"</span></span><br><span class="line">password = <span class="string">"*********"</span></span><br><span class="line"></span><br><span class="line">to_addr = <span class="string">"yhw_software@qq.com"</span></span><br><span class="line"></span><br><span class="line">smtp_server = <span class="string">"smtp.163.com"</span></span><br><span class="line"></span><br><span class="line">msg = MIMEText(<span class="string">"晚上好！"</span>, <span class="string">"plain"</span>, <span class="string">"utf-8"</span>)</span><br><span class="line"></span><br><span class="line">msg[<span class="string">'From'</span>] = format_addr(<span class="string">"我是 &lt;%s&gt;"</span> % from_addr)</span><br><span class="line">msg[<span class="string">"To"</span>] = format_addr(<span class="string">"你是 &lt;%s&gt;"</span> % to_addr)</span><br><span class="line">msg[<span class="string">"Subject"</span>] = Header(<span class="string">"晚安"</span>, <span class="string">"utf-8"</span>).encode()</span><br><span class="line"></span><br><span class="line">server = smtplib.SMTP(smtp_server, <span class="number">25</span>)</span><br><span class="line">server.login(from_addr, password)</span><br><span class="line">server.sendmail(from_addr, [to_addr], msg.as_string())</span><br><span class="line">server.quit()</span><br></pre></td></tr></table></figure></p>

          <br>
<p> from yhw-miracle</p>
<p align="center"><img src="/images/qrcode_for_gh_5efb2780ab44_258.jpg" alt="痛点就是起点"></p>
<p align="center">算法和代码的世界不仅是学习的痛点，而且是成功的起点。欢迎关注，共同进步！</p>

        </section>
      </div>
      
      <!--<div class="block">
  
    <a class="main" href="/">Home</a>
  
    <a class="main" href="/ToYou">ToYou</a>
  
    <a class="main" href="/categories">Categories</a>
  
    <a class="main" href="/atom.xml">RSS</a>
  
</div>
-->
    </div>
    <footer>
  <span class="muted">&copy; 2016 - 2019 yhw-miracle. All Rights Reserved.</span><br>
  <!--<a href='https://github.com/saintwinkle/hexo-theme-scribble' class='muted'>built with Hexo using Scribble theme</a>-->
  <img src="/images/logo.jpg" width="53" height="59" alt="痛点就是起点">
</footer>

  </body>
</html>
