<html>
  <head><meta name="generator" content="Hexo 3.8.0">
    <title>提取多媒体文件 - 痛点就是起点</title>
    <link href="/images/fav.png" rel="shortcut icon">
<link href="/atom.xml" rel="alternate" type="application/rss+xml">
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/highlight.css">
<link rel="stylesheet" href="/css/responsive.css">
<script src="/js/jquery.js"></script>
<script src="/js/basics.js"></script>
<meta content="width=device-width, initial-scale=1.0, user-scalable=no" name="viewport">
<meta content="text/html; charset=utf-8" http-equiv="content-type">


  </head>
  <body>
    <header>
  <a id="go-back-home" href="/"><img src="/images/logo.jpg" alt="Home" width="53" height="59"></a>
  <p>痛点就是起点</p>
  <p>Speaking is as important as doing!</p>
</header>

    <div id="container">
      <div class="block">
  
    <a class="main" href="/">Home</a>
  
    <a class="main" href="/ToYou">ToYou</a>
  
    <a class="main" href="/categories">Categories</a>
  
    <a class="main" href="/atom.xml">RSS</a>
  
</div>

      <section class="paging">
  
  
    <div class="right">
      <a href="/2019/01/14/数据存储为json和csv/">
        ›
      </a>
    </div>
  
</section>

      <div class="content">
        <section class="post">
          <h1>
            <div class="date">2019-01-14</div>
            提取多媒体文件
          </h1>
          <p>利用 python 爬取多媒体文件，存储它们有两种方式，一是只存储 url 链接，二是将文件下载下来。存储文件链接可以将文件的链接信息存储到 json 文件或 csv 文件；下载文件需要用到 urllib 模块提供的 urlretrieve() 函数，urlretrieve() 函数可以将远程数据下载到本地。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">urlretrieve(url,filename=<span class="keyword">None</span>,reporthook=<span class="keyword">None</span>,data=<span class="keyword">None</span>,context=<span class="keyword">None</span>)</span><br></pre></td></tr></table></figure>
<p>参数 filename 是指存储的本地路径；reporthook 是一个回调函数，当连接到服务器以及传输完毕相应的数据块，会调用该回调函数，一般用于显示下载进度。</p>
<p>以爬取天堂网图片为例 <a href="http://www.ivsky.com/tupian/ziranfengguang/" target="_blank" rel="noopener">http://www.ivsky.com/tupian/ziranfengguang/</a>，下载图片的代码如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">schedule</span><span class="params">(blocknum, blocksize, totalsize)</span>:</span></span><br><span class="line">    per = <span class="number">100.0</span> * blocknum * blocksize / totalsize</span><br><span class="line">    <span class="keyword">if</span> per &gt; <span class="number">100</span>:</span><br><span class="line">        per = <span class="number">100</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"当前下载进度： %d"</span> % per</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">user_agent = <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) "</span> \</span><br><span class="line">             <span class="string">"Chrome/71.0.3578.98 Safari/537.36"</span></span><br><span class="line">headers = &#123;<span class="string">"User-Agent"</span>: user_agent&#125;</span><br><span class="line">req = requests.get(<span class="string">"http://www.ivsky.com/tupian/ziranfengguang/"</span>, headers=headers)</span><br><span class="line"></span><br><span class="line">html = etree.HTML(req.text)</span><br><span class="line">img_urls = html.xpath(<span class="string">".//img/@src"</span>)</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> img_url <span class="keyword">in</span> img_urls:</span><br><span class="line">    urllib.urlretrieve(img_url, <span class="string">"./images/img"</span>+str(i)+<span class="string">".jpg"</span>, schedule)</span><br><span class="line">    i += <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p><img src="/images/2019/Jan/1.png" alt=""></p>

          <br>
<p> from yhw-miracle</p>
<p align="center"><img src="/images/qrcode_for_gh_5efb2780ab44_258.jpg" alt="痛点就是起点"></p>
<p align="center">算法和代码的世界不仅是学习的痛点，而且是成功的起点。欢迎关注，共同进步！</p>

        </section>
      </div>
      
      <!--<div class="block">
  
    <a class="main" href="/">Home</a>
  
    <a class="main" href="/ToYou">ToYou</a>
  
    <a class="main" href="/categories">Categories</a>
  
    <a class="main" href="/atom.xml">RSS</a>
  
</div>
-->
    </div>
    <footer>
  <span class="muted">&copy; 2016 - 2019 yhw-miracle. All Rights Reserved.</span><br>
  <!--<a href='https://github.com/saintwinkle/hexo-theme-scribble' class='muted'>built with Hexo using Scribble theme</a>-->
  <img src="/images/logo.jpg" width="53" height="59" alt="痛点就是起点">
</footer>

  </body>
</html>
