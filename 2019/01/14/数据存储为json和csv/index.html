<html>
  <head><meta name="generator" content="Hexo 3.8.0">
    <title>数据存储为json和csv - 痛点就是起点</title>
    <link href="/images/logo.jpg" rel="shortcut icon">
<link href="/atom.xml" rel="alternate" type="application/rss+xml">
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/highlight.css">
<link rel="stylesheet" href="/css/responsive.css">
<script src="/js/jquery.js"></script>
<script src="/js/basics.js"></script>
<meta content="width=device-width, initial-scale=1.0, user-scalable=no" name="viewport">
<meta content="text/html; charset=utf-8" http-equiv="content-type">


  </head>
  <body>
    <header>
  <a id="go-back-home" href="/"><img src="/images/logo.jpg" alt="Home" width="53" height="59"></a>
  <p>痛点就是起点</p>
  <p>Speaking is as important as doing!</p>
</header>

    <div id="container">
      <div class="block">
  
    <a class="main" href="/">Home</a>
  
    <a class="main" href="/ToYou">ToYou</a>
  
    <a class="main" href="/categories">Categories</a>
  
    <a class="main" href="/atom.xml">RSS</a>
  
</div>

      <section class="paging">
  
    <div class="left">
      <a href="/2019/01/14/提取多媒体文件/">
        ‹
      </a>
    </div>
  
  
    <div class="right">
      <a href="/2019/01/13/总结BeautifulSoup/">
        ›
      </a>
    </div>
  
</section>

      <div class="content">
        <section class="post">
          <h1>
            <div class="date">2019-01-14</div>
            数据存储为json和csv
          </h1>
          <p>进行 python 爬虫时，我们需要将数据存储起来。对于小数据量，我们可以存储到 json 文件或 csv 文件。</p>
<h3 id="json存储"><a href="#json存储" class="headerlink" title="json存储"></a>json存储</h3><p>Python 对 json 文件的操作是通过 JSON 模块实现的，分为编码和解码两个过程。</p>
<p>编码是指将 python 对象转换为 json 对象，常用的函数是 dump() 和 dumps()，区别是 dump() 将 python 对象转换为 json 对象，并将 json 对象通过文件流写入文件，dumps() 函数是返回字符串。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dumps(obj,skipkeys=<span class="keyword">False</span>,ensure_ascii=<span class="keyword">True</span>,check_circular=<span class="keyword">True</span>,allow_nan=<span class="keyword">True</span>,cls=<span class="keyword">None</span>,indent=<span class="keyword">None</span>,separators=<span class="keyword">None</span>,encoding=<span class="string">'utf-8'</span>,default=<span class="keyword">None</span>,sort_keys=<span class="keyword">False</span>,**kw)</span><br><span class="line">dumps(obj,skipkeys=<span class="keyword">False</span>,ensure_ascii=<span class="keyword">True</span>,check_circular=<span class="keyword">True</span>,allow_nan=<span class="keyword">True</span>,cls=<span class="keyword">None</span>,indent=<span class="keyword">None</span>,separators=<span class="keyword">None</span>,encoding=<span class="string">'utf-8'</span>,default=<span class="keyword">None</span>,sort_keys=<span class="keyword">False</span>,**kw)</span><br></pre></td></tr></table></figure>
<p>解码是指将 json 对象转换为 python 对象，常用的函数为 load() 和loads()，区别是 load() 是将 json 对象转换为 python 对象，并将 python 对象写入到文件，而 loads() 是返回字符串。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">load(fp,encoding=<span class="keyword">None</span>,cls=<span class="keyword">None</span>,object_hook=<span class="keyword">None</span>,parse_float=<span class="keyword">None</span>,parse_int=<span class="keyword">None</span>,parse_constant=<span class="keyword">None</span>,object_pairs_hook=<span class="keyword">None</span>,**kw)</span><br><span class="line">loads(s,encoding=<span class="keyword">None</span>,cls=<span class="keyword">None</span>,object_hook=<span class="keyword">None</span>,parse_float=<span class="keyword">None</span>,parse_int=<span class="keyword">None</span>,parse_constant=<span class="keyword">None</span>,object_pairs_hook=<span class="keyword">None</span>,**kw)</span><br></pre></td></tr></table></figure>
<h3 id="csv存储"><a href="#csv存储" class="headerlink" title="csv存储"></a>csv存储</h3><p>CSV(Comma-Separated Values，逗号分隔值，有时也称为字符分隔值)，其文件是以纯文本形式存储表格数据。CSV 文件由任意数目的记录组成，记录间以换行符分隔，每条记录由字段组成，字段间的分隔符是其他字符或字符串，最常见的是逗号和制表符。CSV 文件示例如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ID,Username,Password,Age,Country</span><br><span class="line"></span><br><span class="line">1001,yhw,123456,24,China</span><br><span class="line"></span><br><span class="line">1002,Mary,654321,25,USA</span><br><span class="line"></span><br><span class="line">1003,Jack,123567,22,English</span><br></pre></td></tr></table></figure>
<p>Python 通过 csv 库来读写 csv 文件。Python 写 csv 文件，需要用到 write 对象，然后按行写每一个记录；</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line">header = (<span class="string">"ID"</span>, <span class="string">"Username"</span>, <span class="string">"Password"</span>, <span class="string">"Age"</span>, <span class="string">"Country"</span>)</span><br><span class="line">rows = [(<span class="number">1001</span>, <span class="string">"yhw"</span>, <span class="string">"123456"</span>, <span class="number">24</span>, <span class="string">"China"</span>),</span><br><span class="line">        (<span class="number">1002</span>, <span class="string">"Mary"</span>, <span class="string">"654321"</span>, <span class="number">25</span>, <span class="string">"USA"</span>),</span><br><span class="line">        (<span class="number">1003</span>, <span class="string">"Jack"</span>, <span class="string">"123567"</span>, <span class="number">22</span>, <span class="string">"English"</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"test3.csv"</span>, <span class="string">"w"</span>) <span class="keyword">as</span> fp:</span><br><span class="line">    fp_csv = csv.writer(fp)</span><br><span class="line">    fp_csv.writerow(header)</span><br><span class="line">    fp_csv.writerows(rows)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line">rows = [&#123;<span class="string">"ID"</span>: <span class="number">1001</span>, <span class="string">"Username"</span>: <span class="string">"yhw"</span>, <span class="string">"Password"</span>: <span class="string">"123456"</span>, <span class="string">"Age"</span>: <span class="number">24</span>, <span class="string">"Country"</span>: <span class="string">"China"</span>&#125;,</span><br><span class="line">        &#123;<span class="string">"ID"</span>: <span class="number">1002</span>, <span class="string">"Username"</span>: <span class="string">"Mary"</span>, <span class="string">"Password"</span>: <span class="string">"654321"</span>, <span class="string">"Age"</span>: <span class="number">25</span>, <span class="string">"Country"</span>: <span class="string">"USA"</span>&#125;,</span><br><span class="line">        &#123;<span class="string">"ID"</span>: <span class="number">1003</span>, <span class="string">"Username"</span>: <span class="string">"Jack"</span>, <span class="string">"Password"</span>: <span class="string">"123567"</span>, <span class="string">"Age"</span>: <span class="number">22</span>, <span class="string">"Country"</span>: <span class="string">"English"</span>&#125;]</span><br><span class="line">		</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"test3.csv"</span>, <span class="string">"w"</span>) <span class="keyword">as</span> fp:</span><br><span class="line">	fp_csv = csv.DictWriter(fp, header)</span><br><span class="line">    fp_csv.writeheader()</span><br><span class="line">    fp_csv.writerows(rows)</span><br></pre></td></tr></table></figure>
<p>Python 读取 csv 文件需要用到 reader 对象，然后同样是按行读取每一条记录。要读取特定字段信息，python 可以利用索引、命名元祖、字典这三种方式访问。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"test3.csv"</span>, <span class="string">"r"</span>) <span class="keyword">as</span> fp:</span><br><span class="line">    <span class="comment"># 遍历记录</span></span><br><span class="line">    fp_csv = csv.reader(fp)</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> fp_csv:</span><br><span class="line">        <span class="keyword">print</span> row</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 索引</span></span><br><span class="line">    fp_csv = csv.reader(fp)</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> fp_csv:</span><br><span class="line">        <span class="keyword">print</span> row[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 命名元组</span></span><br><span class="line">    fp_csv = csv.reader(fp)</span><br><span class="line">    header = next(fp_csv)</span><br><span class="line">    Row = namedtuple(<span class="string">"Row"</span>, header)</span><br><span class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> fp_csv:</span><br><span class="line">        row = Row(*r)</span><br><span class="line">        <span class="keyword">print</span> row.Username, row.Password</span><br><span class="line">        <span class="keyword">print</span> row</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 字典</span></span><br><span class="line">    fp_csv = csv.DictReader(fp)</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> fp_csv:</span><br><span class="line">        <span class="keyword">print</span> row.get(<span class="string">"Username"</span>)</span><br></pre></td></tr></table></figure>
          <br>
<p> from yhw-miracle</p>
<p align="center"><img src="/images/qrcode_for_gh_5efb2780ab44_258.jpg" alt="痛点就是起点"></p>
<p align="center">算法和代码的世界不仅是学习的痛点，而且是成功的起点。欢迎关注，共同进步！</p>

        </section>
      </div>
      
      <!--<div class="block">
  
    <a class="main" href="/">Home</a>
  
    <a class="main" href="/ToYou">ToYou</a>
  
    <a class="main" href="/categories">Categories</a>
  
    <a class="main" href="/atom.xml">RSS</a>
  
</div>
-->
    </div>
    <footer>
  <span class="muted">&copy; 2016 - 2019 yhw-miracle. All Rights Reserved.</span><br>
  <!--<a href='https://github.com/saintwinkle/hexo-theme-scribble' class='muted'>built with Hexo using Scribble theme</a>-->
  <img src="/images/logo.jpg" width="53" height="59" alt="痛点就是起点">
</footer>

  </body>
</html>
